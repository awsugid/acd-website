---
// Layout Imports
import MainLayout from "../layouts/MainLayout.astro";
// Component Imports
import About from "../components/About";
import Cfp from "../components/Cfp";
import Sessions from "../components/Sessions";
import Speakers from "../components/Speakers";
import Sponsor from "../components/Sponsor";
import PreviousCommunityDay from "../components/PreviousCommunityDay";
import Faq from "../components/Faq";

// astro imports
import { Image } from "astro:assets";
import { getImage } from "astro:assets";

// images
import Acd from "../images/acd.png";
// For remote images
import type { ImageMetadata } from "astro";

// const
const isOpenCfp = false;
const currentYear = 2025;

const questions = [
    {
        question: "What is AWS Community Day?",
        answer: "AWS Community Day is a community-driven event, organized by the AWS community for the community. It's an opportunity for AWS users to come together, share knowledge, learn from each other, exchange best practices, and hear from industry experts through insightful presentations.",
    },
    {
        question: "Who can participate in this event?",
        answer: "AWS Community Day is open to all AWS users, regardless of skill level, who are interested in learning and engaging with the community.",
    },
    {
        question: "Is registration required to participate in this event?",
        answer: "Yes, registration is required to participate. Please register through the event website.",
    },
    {
        question: "Is there a fee for participating in this event?",
        answer: "Yes, there is a registration fee to participate in this event.",
    },
    {
        question: "How to become a sponsor?",
        answer: 'Send an email directly to <a href="mailto: awsugid@gmail.com">awsugid@gmail.com</a>. We will provide you with our sponsorship package, which includes detailed information on sponsorship levels and benefits.',
    },
];
---

<MainLayout isOpenCfp={isOpenCfp}>
    <main class="min-h-screen bg-hero-gradient relative overflow-hidden">
        <!-- Hero Section -->
        <section
            id="hero"
            class="min-h-screen flex items-center justify-center relative px-4 sm:px-6 lg:px-8 py-8 md:py-12"
        >
            <!-- Background Elements -->
            <div class="absolute inset-0 bg-black/20"></div>
            <div
                class="absolute top-20 left-10 w-72 h-72 bg-gradient-to-r from-purple-400/20 to-pink-400/20 rounded-full blur-3xl animate-pulse-slow"
            >
            </div>
            <div
                class="absolute bottom-20 right-10 w-96 h-96 bg-gradient-to-r from-blue-400/15 to-cyan-400/15 rounded-full blur-3xl animate-pulse-slow"
            >
            </div>

            <!-- Main Content Container -->
            <div
                class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center relative z-10 justify-center"
                id="main-content-container"
            >
                <!-- Left Column: Content -->
                <div
                    class="text-center space-y-6 sm:mt-16 flex flex-col items-center"
                    id="left-column"
                >
                    <!-- Logo -->
                    <div class="flex justify-center">
                        <img
                            src="https://gudang.awscommunity.id/acd.png"
                            class="h-20 sm:h-24 lg:h-32 w-auto object-contain drop-shadow-2xl"
                            alt="AWS Community Day Indonesia"
                        />
                    </div>

                    <!-- Main Heading -->
                    <div class="space-y-6">
                        <h1
                            class="text-xl sm:text-2xl lg:text-3xl font-bold leading-tight text-white"
                        >
                            Join the <span
                                class="text-transparent bg-clip-text bg-gradient-to-r from-[#F5C063] to-[#FF9C5F]"
                                >Largest</span
                            > AWS Community Gathering in the Region!
                        </h1>
                        <p
                            class="text-base sm:text-lg lg:text-xl text-gray-200 leading-relaxed font-light"
                        >
                            Learn, network, and grow with fellow <span
                                class="text-orange-300 font-semibold"
                                >cloud enthusiasts</span
                            > in the region
                        </p>
                    </div>

                    <!-- Event Details -->
                    <div>
                        <div class="space-y-5">
                            <div
                                class="flex items-center space-x-3 text-base sm:text-lg"
                            >
                                <span
                                    class="text-xl bg-white/10 p-1.5 rounded-full"
                                    >üìÖ</span
                                >
                                <span
                                    class="text-white font-semibold tracking-wide"
                                    >October 25, 2025</span
                                >
                            </div>
                            <div
                                class="flex items-center space-x-3 text-base sm:text-lg"
                            >
                                <span
                                    class="text-xl bg-white/10 p-1.5 rounded-full"
                                    >üìç</span
                                >
                                <span class="text-gray-200 font-bold"
                                    >Auditorium Binus @Alam Sutera, Tangerang, Indonesia</span
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Countdown -->
                <div class="flex justify-center lg:justify-end" id="countdown-column">
                    <div class="text-center">
                        <!-- Countdown Grid -->
                        <h1
                            class="text-xl sm:text-2xl lg:text-3xl font-bold leading-tight text-white mb-4"
                        >
                            Event starts in:
                        </h1>

                        <div class="grid grid-cols-4 gap-2 sm:gap-3 md:gap-4">
                            <!-- Days -->
                            <div
                                class="bg-black/40 backdrop-blur-lg border border-white/20 rounded-xl p-3 sm:p-4 md:p-5 hover:bg-black/50 transition-all duration-300 shadow-xl flex flex-col items-center"
                            >
                                <div
                                    class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white"
                                    id="days"
                                >
                                    --
                                </div>
                                <div
                                    class="text-xs sm:text-sm text-gray-300 font-medium mt-2"
                                >
                                    Days
                                </div>
                            </div>

                            <!-- Hours -->
                            <div
                                class="bg-black/40 backdrop-blur-lg border border-white/20 rounded-xl p-3 sm:p-4 md:p-5 hover:bg-black/50 transition-all duration-300 shadow-xl flex flex-col items-center"
                            >
                                <div
                                    class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white"
                                    id="hours"
                                >
                                    --
                                </div>
                                <div
                                    class="text-xs sm:text-sm text-gray-300 font-medium mt-2"
                                >
                                    Hrs
                                </div>
                            </div>

                            <!-- Minutes -->
                            <div
                                class="bg-black/40 backdrop-blur-lg border border-white/20 rounded-xl p-3 sm:p-4 md:p-5 hover:bg-black/50 transition-all duration-300 shadow-xl flex flex-col items-center"
                            >
                                <div
                                    class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white"
                                    id="minutes"
                                >
                                    --
                                </div>
                                <div
                                    class="text-xs sm:text-sm text-gray-300 font-medium mt-2"
                                >
                                    Min
                                </div>
                            </div>

                            <!-- Seconds -->
                            <div
                                class="bg-black/40 backdrop-blur-lg border border-white/20 rounded-xl p-3 sm:p-4 md:p-5 hover:bg-black/50 transition-all duration-300 shadow-xl flex flex-col items-center"
                            >
                                <div
                                    class="text-4xl sm:text-5xl lg:text-6xl font-bold text-orange-400 animate-pulse"
                                    id="seconds"
                                >
                                    --
                                </div>
                                <div
                                    class="text-xs sm:text-sm text-gray-300 font-medium mt-2"
                                >
                                    Sec
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <script>
            let countdownInterval;
            function updateCountdown() {
                const now = new Date().getTime();
                const eventTime = new Date("2025-10-25T09:00:00+07:00").getTime();
                const timeLeft = eventTime - now;

                const daysEl = document.getElementById("days");
                const hoursEl = document.getElementById("hours");
                const minutesEl = document.getElementById("minutes");
                const secondsEl = document.getElementById("seconds");
                const countdownColumn = document.getElementById("countdown-column");
                const leftColumn = document.getElementById("left-column");
                const mainContentContainer = document.getElementById("main-content-container");

                if (timeLeft <= 0) {
                    daysEl.textContent = "0";
                    hoursEl.textContent = "0";
                    minutesEl.textContent = "0";
                    secondsEl.textContent = "0";

                    // Hide countdown
                    if (countdownColumn) countdownColumn.style.display = "none";
                    if (leftColumn) leftColumn.style.width = "100%";
                    if (mainContentContainer) mainContentContainer.style.gridTemplateColumns = "1fr";

                    // Move Sessions and Speakers group above Tickets
                    const ticketsSection = document.getElementById("tickets");
                    const sessionsSpeakersGroup = document.getElementById("sessions-speakers-group");
                    if (ticketsSection && sessionsSpeakersGroup) {
                        ticketsSection.parentNode.insertBefore(sessionsSpeakersGroup, ticketsSection);
                    }

                    // Stop the interval
                    if (countdownInterval) clearInterval(countdownInterval);
                    return;
                }

                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                animateValue(daysEl, parseInt(daysEl.textContent) || 0, days);
                animateValue(hoursEl, parseInt(hoursEl.textContent) || 0, hours);
                animateValue(minutesEl, parseInt(minutesEl.textContent) || 0, minutes);
                animateValue(secondsEl, parseInt(secondsEl.textContent) || 0, seconds);
            }

            function animateValue(element, start, end) {
                if (start === end || !element) return;
                if (isNaN(start)) start = 0;
                if (isNaN(end)) end = 0;

                element.style.transform = "scale(1.1)";
                element.style.transition = "transform 0.25s ease-in-out";
                setTimeout(() => {
                    element.textContent = end.toString().padStart(2, "0");
                    element.style.transform = "scale(1)";
                }, 200);
            }

            document.addEventListener("DOMContentLoaded", () => {
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
                setTimeout(() => {
                    document
                        .querySelectorAll("#hero > div > div > div")
                        .forEach((el, i) => {
                            el.style.opacity = "0";
                            el.style.transform = "translateY(30px)";
                            el.style.transition = "all 0.8s cubic-bezier(0.4, 0, 0.2, 1)";
                            setTimeout(() => {
                                el.style.opacity = "1";
                                el.style.transform = "translateY(0)";
                            }, i * 200);
                        });
                }, 100);
            });
        </script>
    </main>

    <!-- Tickets Section -->
    <section id="tickets" class="py-20 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Section Header -->
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold text-white mb-6">
                    Get Your <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-[#F5C063] to-[#FF9C5F]"
                        >Tickets</span
                    >
                </h2>
                <p
                    class="text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed"
                >
                    Secure your spot at Indonesia's largest AWS community
                    gathering. Limited seats available!
                </p>
            </div>

            <!-- Pretix Widget Container -->
            <div class="max-w-6xl mx-auto">
                <div
                    class="bg-white/10 backdrop-blur-lg border border-white/20 rounded-2xl p-8 shadow-2xl"
                >
                    <!-- Pretix Widget - Configured for iframe embedding -->
                    <pretix-widget
                        event="https://join.awscommunity.id/AWSUserGroupIndonesia/communityday2025/"
                        skip-ssl-check
                    ></pretix-widget>

                    <!-- Fallback for browsers with JavaScript disabled -->
                    <noscript>
                        <div class="pretix-widget">
                            <div
                                class="pretix-widget-info-message text-center p-8"
                            >
                                <p class="text-gray-300 mb-4">
                                    JavaScript is disabled in your browser.
                                </p>
                                <a
                                    target="_blank"
                                    href="https://join.awscommunity.id/AWSUserGroupIndonesia/communityday2025/"
                                    class="inline-block bg-gradient-to-r from-orange-500 to-pink-600 hover:from-orange-600 hover:to-pink-700 text-white font-semibold py-3 px-8 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg"
                                >
                                    Purchase Tickets Here
                                </a>
                            </div>
                        </div>
                    </noscript>
                </div>

                <!-- Additional Info -->
                <div class="mt-8 text-center">
                    <p class="text-gray-400 text-sm">
                        üîí Secure payment processing
                    </p>
                </div>
            </div>
        </div>

        <!-- Custom CSS for Pretix Widget iframe embedding -->
        <style>
            /* Ensure widget container has proper sizing */
            pretix-widget {
                display: block;
                width: 100%;
            }

            /* Style for embedded iframes */
            pretix-widget iframe {
                width: 100% !important;
                border: none !important;
                border-radius: 12px !important;
                background: white;
            }

            /* Loading state styling */
            pretix-widget:empty {
                background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                background-size: 200% 100%;
                animation: loading 1.5s infinite;
                border-radius: 12px;
                min-height: 200px;
            }

            @keyframes loading {
                0% { background-position: 200% 0; }
                100% { background-position: -200% 0; }
            }

            /* Hide Pretix widget footer/branding - targeting specific elements from DOM inspection */
            article[data-event-url] a[href="https://awscommunity.id"],
            article[data-event-url] a[href="https://pretix.eu"],
            article[data-event-url] a[href*="agpl_source"] {
                display: none !important;
                visibility: hidden !important;
            }

            /* Hide the parentheses and text around source code link */
            article[data-event-url] a[href*="agpl_source"]::before,
            article[data-event-url] a[href*="agpl_source"]::after {
                display: none !important;
            }

            /* Alternative approach - hide all links after the last button in the widget */
            pretix-widget article button:last-of-type ~ a {
                display: none !important;
            }

            /* Hide text nodes containing parentheses after buttons */
            pretix-widget article button:last-of-type ~ * {
                font-size: 0 !important;
                line-height: 0 !important;
                opacity: 0 !important;
            }

            /* Keep only the ticket content visible */
            pretix-widget article > *:not(h3):not(.row):not(button):not(.pretix-widget-item):not([class*="product"]) {
                display: none !important;
            }
        </style>

        <!-- JavaScript to remove Pretix footer after widget loads -->
        <script>
            // Function to remove Pretix footer elements
            function removePretixFooter() {
                // Wait for widget to load
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) { // Element node
                                // Find and remove footer links
                                const footerLinks = node.querySelectorAll('a[href="https://awscommunity.id"], a[href="https://pretix.eu"], a[href*="agpl_source"]');
                                footerLinks.forEach(link => {
                                    // Remove the link and surrounding text
                                    const parent = link.parentNode;
                                    const nextSibling = link.nextSibling;
                                    const prevSibling = link.previousSibling;

                                    // Remove parentheses and text around links
                                    if (nextSibling && nextSibling.nodeType === 3 && nextSibling.textContent.trim() === ')') {
                                        nextSibling.remove();
                                    }
                                    if (prevSibling && prevSibling.nodeType === 3 && prevSibling.textContent.trim() === '(') {
                                        prevSibling.remove();
                                    }

                                    link.remove();
                                });

                                // Also check the widget article for footer elements
                                const articles = node.querySelectorAll('article');
                                articles.forEach(article => {
                                    const footerLinksInArticle = article.querySelectorAll('a[href="https://awscommunity.id"], a[href="https://pretix.eu"], a[href*="agpl_source"]');
                                    footerLinksInArticle.forEach(link => {
                                        const parent = link.parentNode;
                                        const nextSibling = link.nextSibling;
                                        const prevSibling = link.previousSibling;

                                        if (nextSibling && nextSibling.nodeType === 3 && nextSibling.textContent.trim() === ')') {
                                            nextSibling.remove();
                                        }
                                        if (prevSibling && prevSibling.nodeType === 3 && prevSibling.textContent.trim() === '(') {
                                            prevSibling.remove();
                                        }

                                        link.remove();
                                    });
                                });
                            }
                        });
                    });
                });

                // Start observing the tickets section
                const ticketsSection = document.querySelector('#tickets');
                if (ticketsSection) {
                    observer.observe(ticketsSection, {
                        childList: true,
                        subtree: true
                    });
                }

                // Also try to remove footer elements that might already be present
                setTimeout(() => {
                    const existingFooterLinks = document.querySelectorAll('#tickets a[href="https://awscommunity.id"], #tickets a[href="https://pretix.eu"], #tickets a[href*="agpl_source"]');
                    existingFooterLinks.forEach(link => {
                        const nextSibling = link.nextSibling;
                        const prevSibling = link.previousSibling;

                        if (nextSibling && nextSibling.nodeType === 3 && nextSibling.textContent.trim() === ')') {
                            nextSibling.remove();
                        }
                        if (prevSibling && prevSibling.nodeType === 3 && prevSibling.textContent.trim() === '(') {
                            prevSibling.remove();
                        }

                        link.remove();
                    });
                }, 1000);

                // Retry every 2 seconds for the first 10 seconds
                for (let i = 1; i <= 5; i++) {
                    setTimeout(() => {
                        const footerLinks = document.querySelectorAll('#tickets a[href="https://awscommunity.id"], #tickets a[href="https://pretix.eu"], #tickets a[href*="agpl_source"]');
                        footerLinks.forEach(link => {
                            const nextSibling = link.nextSibling;
                            const prevSibling = link.previousSibling;

                            if (nextSibling && nextSibling.nodeType === 3 && nextSibling.textContent.trim() === ')') {
                                nextSibling.remove();
                            }
                            if (prevSibling && prevSibling.nodeType === 3 && prevSibling.textContent.trim() === '(') {
                                prevSibling.remove();
                            }

                            link.remove();
                        });
                    }, i * 2000);
                }
            }

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', removePretixFooter);
            } else {
                removePretixFooter();
            }
        </script>
    </section>

    <!-- Sessions & Speakers Group -->
    <div id="sessions-speakers-group">
        { !isOpenCfp ? <Sessions client:load data-section="sessions" /> : null }
        { !isOpenCfp ? <Speakers client:load data-section="speakers" /> : null }
    </div>

    <!-- About -->
    <About />
    <Cfp client:load currentYear={currentYear} isOpen={isOpenCfp} />
    <Sponsor
        currentYear={currentYear}
        sponsorProposal="https://docs.google.com/presentation/d/1OJfKbSufY74B0P2hEVBS8t6bTAA9sqgKvbNl0tsYKbk/edit?usp=sharing"
    />
    <Faq client:load questionList={questions} />
    <PreviousCommunityDay
        albums={[
            {
                link: "https://photos.app.goo.gl/ohFB4F8EXHGYZ8Rq9",
                title: "AWS Community Day 2024",
            },
            {
                link: "https://drive.google.com/drive/folders/1X4V5RV25xvGHiSADFU_UvLasCN2T_ru_?usp=sharing",
                title: "AWS Community Day 2023",
            },
        ]}
    />
</MainLayout>
